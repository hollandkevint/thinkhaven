---
phase: 02-beta-access-control
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/web/app/waitlist/page.tsx
  - apps/web/app/components/waitlist/WaitlistForm.tsx
  - apps/web/app/page.tsx
autonomous: true

must_haves:
  truths:
    - "Visiting /waitlist shows 'you're on the waitlist' message"
    - "Landing page has working waitlist signup form"
    - "Submitting email to waitlist form creates row in beta_access table"
    - "Duplicate email submission shows 'already on the list' message (not error)"
  artifacts:
    - path: "apps/web/app/waitlist/page.tsx"
      provides: "Waitlist pending page for unapproved users"
      min_lines: 20
    - path: "apps/web/app/components/waitlist/WaitlistForm.tsx"
      provides: "Reusable waitlist signup form component"
      exports: ["WaitlistForm"]
    - path: "apps/web/app/page.tsx"
      provides: "Landing page with waitlist form"
      contains: "WaitlistForm"
  key_links:
    - from: "apps/web/app/components/waitlist/WaitlistForm.tsx"
      to: "beta_access table"
      via: "supabase.from('beta_access').insert"
      pattern: "from\\('beta_access'\\)"
    - from: "apps/web/app/page.tsx"
      to: "WaitlistForm"
      via: "import and render"
      pattern: "import.*WaitlistForm"
---

<objective>
Create the waitlist UI: the pending page that unapproved users see, and the signup form for the landing page. This completes the user-facing waitlist experience.

Purpose: Users need clear feedback when on the waitlist, and a way to join from the landing page.
Output: /waitlist page and landing page waitlist form that writes to beta_access table.
</objective>

<execution_context>
@/Users/kthkellogg/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kthkellogg/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-beta-access-control/02-RESEARCH.md
@apps/web/app/page.tsx
@apps/web/lib/supabase/client.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create waitlist pending page</name>
  <files>apps/web/app/waitlist/page.tsx</files>
  <action>
Create the /waitlist route that unapproved users are redirected to.

This page should:
1. Be a simple server component (no 'use client' needed)
2. Display a friendly message confirming they're on the waitlist
3. Set expectations about what happens next
4. Provide contact email for questions
5. Use the project's design system (Tailwind, cream/parchment colors from globals.css)

```typescript
export default function WaitlistPage() {
  return (
    <div className="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100">
      <div className="max-w-md text-center p-8 bg-white rounded-2xl shadow-xl">
        <div className="text-6xl mb-6">ðŸŽ‰</div>
        <h1 className="text-3xl font-bold text-gray-900 mb-4">
          You're on the waitlist!
        </h1>
        <p className="text-gray-600 mb-6">
          Thanks for signing up for ThinkHaven beta. We're letting people in
          gradually to ensure everyone gets a great experience.
        </p>
        <p className="text-gray-600 mb-6">
          We'll email you when your spot opens up. This usually takes 1-3 days.
        </p>
        <div className="border-t border-gray-200 pt-6 mt-6">
          <p className="text-sm text-gray-500">
            Questions? Email{' '}
            <a
              href="mailto:kevin@kevintholland.com"
              className="text-blue-600 hover:underline"
            >
              kevin@kevintholland.com
            </a>
          </p>
        </div>
      </div>
    </div>
  );
}
```

Key points:
- Simple, friendly tone
- Sets expectation (1-3 days)
- Contact info for direct support
- No login/logout buttons (user may or may not be authenticated)
  </action>
  <verify>
1. Directory exists: `mkdir -p apps/web/app/waitlist` (if needed)
2. File exists: `ls apps/web/app/waitlist/page.tsx`
3. Contains waitlist messaging: `grep "waitlist" apps/web/app/waitlist/page.tsx`
  </verify>
  <done>/waitlist route exists and displays waitlist confirmation message.</done>
</task>

<task type="auto">
  <name>Task 2: Create WaitlistForm component</name>
  <files>apps/web/app/components/waitlist/WaitlistForm.tsx</files>
  <action>
Create a reusable client component for the waitlist signup form.

```typescript
'use client';

import { useState } from 'react';
import { createBrowserClient } from '@supabase/ssr';

export function WaitlistForm() {
  const [email, setEmail] = useState('');
  const [status, setStatus] = useState<'idle' | 'loading' | 'success' | 'error'>('idle');
  const [message, setMessage] = useState('');

  const supabase = createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!email.trim()) return;

    setStatus('loading');
    setMessage('');

    const { error } = await supabase
      .from('beta_access')
      .insert({ email: email.trim(), source: 'landing_page' });

    if (error) {
      // Unique constraint violation = already on list
      if (error.code === '23505') {
        setStatus('success');
        setMessage("You're already on the list! We'll email you soon.");
      } else {
        setStatus('error');
        setMessage('Something went wrong. Please try again.');
        console.error('Waitlist signup error:', error);
      }
    } else {
      setStatus('success');
      setMessage("You're on the list! We'll email you when your spot opens up.");
      setEmail('');
    }
  };

  return (
    <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row gap-3 max-w-md mx-auto">
      <input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="your@email.com"
        required
        disabled={status === 'loading'}
        className="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 disabled:opacity-50"
      />
      <button
        type="submit"
        disabled={status === 'loading'}
        className="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
      >
        {status === 'loading' ? 'Joining...' : 'Join Waitlist'}
      </button>
      {message && (
        <p
          className={`text-sm mt-2 sm:mt-0 sm:absolute sm:left-0 sm:right-0 sm:-bottom-8 text-center ${
            status === 'error' ? 'text-red-600' : 'text-green-600'
          }`}
        >
          {message}
        </p>
      )}
    </form>
  );
}
```

Key points:
- 'use client' for interactivity
- Uses createBrowserClient from @supabase/ssr (not deprecated auth-helpers)
- Handles unique constraint error gracefully ("already on list")
- Responsive layout (column on mobile, row on desktop)
- Disabled state during submission
- Success clears the email field
  </action>
  <verify>
1. Directory exists: `mkdir -p apps/web/app/components/waitlist` (if needed)
2. File exists: `ls apps/web/app/components/waitlist/WaitlistForm.tsx`
3. Exports WaitlistForm: `grep "export function WaitlistForm" apps/web/app/components/waitlist/WaitlistForm.tsx`
4. Uses beta_access table: `grep "beta_access" apps/web/app/components/waitlist/WaitlistForm.tsx`
  </verify>
  <done>WaitlistForm component exists and inserts into beta_access table on submit.</done>
</task>

<task type="auto">
  <name>Task 3: Add waitlist form to landing page</name>
  <files>apps/web/app/page.tsx</files>
  <action>
Modify the landing page to include the waitlist signup form. Replace or supplement the current CTA section.

Changes to make:
1. Import WaitlistForm at the top
2. Add a waitlist section above or replacing the "$99 Validate" CTA
3. Keep the Free Assessment button as secondary CTA

For beta launch, the primary CTA should be "Join the Waitlist" not "Buy Now". Replace the checkout buttons with the waitlist form.

Find the Hero section (around line 54-92) and update:
- Replace the "$99 Validate My Idea" button with the WaitlistForm component
- Keep "Try Free Assessment First" as secondary option
- Update the value prop copy to reflect beta access

Also find the Final CTA section (around line 174-208) and:
- Replace checkout button with waitlist form
- Update copy to reflect waitlist signup

Key changes:
```typescript
import { WaitlistForm } from '@/components/waitlist/WaitlistForm';

// In Hero section, replace the checkout button div with:
<div className="relative">
  <WaitlistForm />
</div>

// Update Badge text to mention beta:
<Badge variant="secondary" className="px-4 py-2 text-sm font-semibold mb-6">
  ðŸš€ Join the Beta - Limited Spots Available
</Badge>
```

The handleCheckout function and checkoutLoading state can be removed since we're not using them during beta.
  </action>
  <verify>
1. File imports WaitlistForm: `grep "import.*WaitlistForm" apps/web/app/page.tsx`
2. File renders WaitlistForm: `grep "<WaitlistForm" apps/web/app/page.tsx`
3. No TypeScript errors: `cd apps/web && npx tsc --noEmit app/page.tsx 2>&1 | head -5`
  </verify>
  <done>Landing page displays waitlist signup form as primary CTA instead of checkout buttons.</done>
</task>

</tasks>

<verification>
1. Waitlist page exists and loads:
   - `ls apps/web/app/waitlist/page.tsx`

2. WaitlistForm component exists:
   - `ls apps/web/app/components/waitlist/WaitlistForm.tsx`

3. Landing page includes form:
   - `grep "WaitlistForm" apps/web/app/page.tsx`

4. No TypeScript errors in modified files:
   - `cd apps/web && npx tsc --noEmit`

5. Dev server starts without errors:
   - `cd apps/web && npm run build 2>&1 | tail -10` (build test)
</verification>

<success_criteria>
- /waitlist route exists and shows friendly waitlist message
- WaitlistForm component inserts into beta_access table
- Landing page shows waitlist form instead of checkout buttons
- Duplicate email submissions show "already on list" (not error)
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-beta-access-control/02-03-SUMMARY.md`
</output>
